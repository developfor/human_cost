!function(){var e=function(){function e(){return d3.scale.ordinal().domain(["male","female","female & male"]).range(["#97BF3F","#FF4500","#f4e09c"])}function t(){return d3.scale.ordinal().domain(["male","female","female & male"]).range(["#4c6021","#741f00","#f79f05"])}function a(e){return"$"+e}function r(e,t){return d3.scale.pow().exponent(t).domain([0,d3.max(e,function(e){return e.price})]).range([g,x])}function o(e){function t(t){v.each(c(.2*t.alpha)).each(s(.5,e)).attr("cx",function(e){return e.x=Math.max(e.radius,Math.min(d-e.radius,e.x))}).attr("cy",function(e){return e.y=Math.max(e.radius,Math.min(l-25-e.radius,e.y))})}function a(e){return d3.layout.force().stop().nodes(e).size([d,l]).friction(.8).gravity(0).charge(-10).on("tick",t).start()}var r=[["female & male",100],["female",390],["male",650]],o=[["unstated",50],["-500 - 0",190],["1650",330],["1850 - 1855",470],["2004 - 2013",650]],n=[["baby",40],["child",210],["adult",430],["unstated",675]],i=d3.scale.ordinal().domain([r[0][0],r[1][0],r[2][0]]).range([r[0][1],r[1][1],r[2][1]]),u=d3.scale.ordinal().domain([n[0][0],n[1][0],n[2][0],n[3][0]]).range([n[0][1],n[1][1],n[2][1],n[3][1]]),g=d3.scale.ordinal().domain([o[0][0],o[1][0],o[2][0],o[3][0],o[4][0]]).range([o[0][1],o[1][1],o[2][1],o[3][1],o[4][1]]),x=d3.svg.axis().scale(i).orient("bottom").ticks(5),h=d3.svg.axis().scale(u).orient("bottom").ticks(5),m=d3.svg.axis().scale(g).orient("bottom").ticks(5),p=a(e),v=f.selectAll("circle").data(e);v.enter().append("circle"),v.attr("r",function(e){return e.radius}).style("fill",function(e){return e.color}).style("stroke",function(e){return e.colorStroke}).attr("class","bubbles").call(p.drag),f.append("g").attr("class","x axis axisGender").attr("transform","translate(0, 280)").call(x),f.append("g").attr("class","x axis axisAge").attr("transform","translate(0, 280)").call(h),f.append("g").attr("class","x axis axisDate").attr("transform","translate(0, 280)").call(m),$("#sort").on("click",function(){$(".axisGender").hide(),$(".axisAge").hide(),$(".axisDate").hide(),$("#sort-age, #sort-gender, #sort-date").css("background-color","white").css("color","black"),$("#sort").css("background-color","#C9C9C9").css("color","white");for(var t=0;t<e.length;t++)e[t].cx=360;var r=a(e);v.call(r.drag)}),$("#sort-age").on("click",function(){$(".axisGender").hide(),$(".axisDate").hide(),$(".axisAge").show(),$("#sort, #sort-gender, #sort-date").css("background-color","white").css("color","black"),$("#sort-age").css("background-color","#C9C9C9").css("color","white");for(var t=0;t<e.length;t++)"baby"===e[t].age?e[t].cx=n[0][1]:"child"===e[t].age?e[t].cx=n[1][1]:"adult"===e[t].age?e[t].cx=n[2][1]:"unstated"===e[t].age&&(e[t].cx=n[3][1]);var r=a(e);v.call(r.drag)}),$("#sort-gender").on("click",function(){$(".axisAge").hide(),$(".axisDate").hide(),$(".axisGender").show(),$("#sort, #sort-age, #sort-date").css("background-color","white").css("color","black"),$("#sort-gender").css("background-color","#C9C9C9").css("color","white");for(var t=0;t<e.length;t++)"female & male"===e[t].gender?e[t].cx=r[0][1]:"female"===e[t].gender?e[t].cx=r[1][1]:"male"===e[t].gender&&(e[t].cx=r[2][1]);var o=a(e);v.call(o.drag)}),$("#sort-date").on("click",function(){$(".axisGender").hide(),$(".axisAge").hide(),$(".axisDate").show(),$("#sort, #sort-age, #sort-gender").css("background-color","white").css("color","black"),$("#sort-date").css("background-color","#C9C9C9").css("color","white");for(var t=0;t<e.length;t++)"unstated"===e[t].decades?e[t].cx=o[0][1]:"bce"===e[t].decades?e[t].cx=o[1][1]:"early_modern"===e[t].decades?e[t].cx=o[2][1]:"eighteen"===e[t].decades?e[t].cx=o[3][1]:"present"===e[t].decades&&(e[t].cx=o[4][1]);var r=a(e);v.call(r.drag)}),v.exit().remove()}function n(){d3.selectAll("circle").on("mouseover",function(e){d3.select("#tooltip").select("#value").text(h(e.price)),d3.select("#detail").text(e.detail),d3.select("#age").text(e.age),d3.select("#date").text(e.date),d3.select("#gender").text(e.gender),d3.select("#tooltip").classed("hidden",!1),d3.select(this).style("stroke-width","4")}).on("mouseout",function(){d3.select("#tooltip").classed("hidden",!0),d3.select(this).style("stroke-width","1.5")})}function c(e){return function(t){t.y+=(t.cy-t.y)*e,t.x+=(t.cx-t.x)*e}}function s(e,t){var a=d3.geom.quadtree(t);return function(t){var r=t.radius+radius.domain()[1]+u,o=t.x-r,n=t.x+r,c=t.y-r,s=t.y+r;a.visit(function(a,r,i,d,l){if(a.point&&a.point!==t){var g=t.x-a.point.x,x=t.y-a.point.y,f=Math.sqrt(g*g+x*x),h=t.radius+a.point.radius+(t.color!==a.point.color)*u;h>f&&(f=(f-h)/f*e,t.x-=g*=f,t.y-=x*=f,a.point.x+=g,a.point.y+=x)}return r>n||o>d||i>s||c>l})}}var i={top:4,right:5,bottom:4,left:5},d=770-i.left-i.right,l=320-i.top-i.bottom,u=0,g=4,x=48,f=d3.select("#viz").append("svg").attr("width",d+i.left+i.right).attr("height",l+i.top+i.bottom).attr("class","svg").append("g").attr("transform","translate("+i.left+","+i.top+")");d3.json("data/human.json",function(c,s){if(c)console.log("there is an error "+c);else{var i=e(s),u=t(s);radius=r(s,.8);var g=0,x=d3.range(s.length).map(function(){var e=s[g];return g++,{radius:radius(e.price),color:i(e.gender),colorStroke:u(e.gender),price:a(e.price),detail:e.detail,age:e.age,date:e.date,gender:e.gender,decades:e.decades,cx:d/2,cy:l/2}});o(x),n(x)}});var h=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}};e()}(this,document);